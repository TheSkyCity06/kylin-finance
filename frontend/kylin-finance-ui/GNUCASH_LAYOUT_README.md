# GnuCash 风格主 UI 框架

## 概述

已成功重写系统的主 UI 框架，实现了类似 GnuCash 的经典布局，包括：

1. **多页签管理系统**：类似浏览器的 Tab 栏
2. **左侧科目树**：可折叠，显示科目代码、名称及实时余额
3. **工具栏**：Tab 下方的功能按钮区
4. **紧凑型设计**：财务灰/白配色，高数据密度

## 组件结构

### 1. MainLayout.vue
主布局组件，包含：
- 左侧菜单（SideMenu）
- 左侧科目树（AccountTree）
- Tab 栏（TabBar）
- 工具栏（Toolbar）
- Tab 内容视图（TabView）

### 2. SideMenu.vue
左侧导航菜单，包含：
- 仪表板
- 凭证管理（录入、查询、快捷录入）
- 科目管理
- 商业单据（单据管理、支付核销）
- 财务报表（试算平衡表、资产负债表、现金流量表）

### 3. AccountTree.vue
左侧科目树组件，功能：
- 显示科目代码、名称、实时余额
- 支持搜索过滤
- 可折叠/展开
- 点击科目节点打开详情 Tab
- 自动加载并显示科目余额

### 4. TabBar.vue
Tab 栏组件，功能：
- 显示所有打开的 Tab
- 支持点击切换 Tab
- 支持关闭 Tab（点击 X）
- 右键菜单：关闭、关闭其他、关闭所有
- 自动激活当前路由对应的 Tab

### 5. Toolbar.vue
工具栏组件，包含按钮：
- **保存**：保存当前页面数据（Ctrl+S）
- **过账**：执行过账操作
- **反向**：生成反向凭证
- **今日**：跳至今日
- **搜索**：打开搜索功能
- **打印**：打印当前页面
- **设置**：打开设置

### 6. TabView.vue
Tab 内容视图组件：
- 使用 `keep-alive` 缓存组件
- 根据 Tab 配置决定哪些组件需要缓存

## 状态管理

### tabStore.ts
使用 Pinia 管理 Tab 状态：
- `tabs`: Tab 列表
- `activeTabId`: 当前激活的 Tab ID
- `addTab()`: 添加 Tab
- `removeTab()`: 移除 Tab
- `setActiveTab()`: 设置激活 Tab
- `closeOthers()`: 关闭其他 Tab
- `closeAll()`: 关闭所有 Tab

## 路由集成

路由变化时自动添加 Tab：
- 点击左侧菜单项时，自动创建对应的 Tab
- 点击科目树节点时，创建科目详情 Tab
- Dashboard 页面不创建 Tab，直接显示

## 样式特点

### 紧凑型设计
- 字体大小：11-12px
- 按钮高度：24px
- 表格行高：紧凑
- 间距：减小 padding 和 margin

### 配色方案
- 背景色：`#f5f5f5`（浅灰）
- 边框色：`#d0d0d0`（中灰）
- 文字色：`#333`（深灰）
- 激活色：`#409eff`（蓝色）

## 使用说明

### 打开新页面
1. 点击左侧菜单项，自动创建 Tab
2. 点击科目树节点，创建科目详情 Tab
3. Tab 会自动激活并显示对应内容

### 切换 Tab
- 点击 Tab 标签切换
- 使用路由导航会自动切换对应 Tab

### 关闭 Tab
- 点击 Tab 右侧的 X 按钮
- 右键菜单选择"关闭"
- 右键菜单选择"关闭其他"或"关闭所有"

### 工具栏操作
- 工具栏按钮会触发全局事件
- 页面组件可以监听这些事件执行相应操作
- 例如：`window.addEventListener('toolbar-save', handleSave)`

## 技术栈

- Vue 3 Composition API
- Pinia（状态管理）
- Vue Router（路由）
- Element Plus（UI 组件）
- TypeScript（类型安全）

## 注意事项

1. **Tab 管理**：Tab 与路由绑定，路由变化时自动同步 Tab 状态
2. **组件缓存**：使用 `keep-alive` 缓存组件，提升性能
3. **余额显示**：科目树会自动加载并显示科目余额
4. **响应式设计**：布局支持窗口大小调整

## 后续优化建议

1. 添加 Tab 拖拽排序功能
2. 支持 Tab 固定功能
3. 添加键盘快捷键支持
4. 优化科目树性能（大数据量）
5. 添加主题切换功能
